<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Class</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 500px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            font-weight: bold;
        }
        input, select, button {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
        }
        .subject-container {
            display: flex;
            gap: 10px;
        }
        .add-btn {
            margin-top: 10px;
            cursor: pointer;
            background-color: green;
            color: white;
            border: none;
        }
        .remove-btn {
            background-color: red;
            color: white;
            border: none;
            cursor: pointer;
        }
        button {
            background-color: blue;
            color: white;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Add New Class</h2>
        <form id="classForm">
            <div class="form-group">
                <label for="classID">Class ID:</label>
                <input type="text" id="classID" name="classID" required>
            </div>
            <div class="form-group">
                <label for="branch">Branch:</label>
                <input type="text" id="branch" name="branch" required>
            </div>
            <div class="form-group">
                <label for="semester">Semester:</label>
                <input type="number" id="semester" name="semester" required>
            </div>
            
            <div class="form-group">
                <label>Subjects:</label>
                <div id="subjects">
                    <div class="subject-container">
                        <input type="text" name="subjects[]" placeholder="Enter Subject" required>
                        <button type="button" class="remove-btn" onclick="removeSubject(this)">X</button>
                    </div>
                </div>
                <button type="button" class="add-btn" onclick="addSubject()">Add Subject</button>
            </div>

            <h3>Timetable (Mon-Sat, 6 Hours Each)</h3>
            <div id="timetable">
                <script>
                    const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
                    for (let i = 0; i < days.length; i++) {
                        document.write(`<div class="form-group"><label>${days[i]}:</label>`);
                        for (let j = 1; j <= 6; j++) {
                            document.write(`<input type="text" name="${days[i].toLowerCase()}[]" placeholder="Hour ${j} (Leave empty if no class)">`);
                        }
                        document.write("</div>");
                    }
                </script>
            </div>

            <button type="submit">Submit</button>
        </form>
    </div>

<script>
    function addSubject() {
        let container = document.getElementById("subjects");
        let newInput = document.createElement("div");
        newInput.classList.add("subject-container");
        newInput.innerHTML = `<input type="text" name="subjects[]" placeholder="Enter Subject" required>
                              <button type="button" class="remove-btn" onclick="removeSubject(this)">X</button>`;
        container.appendChild(newInput);
    }

    function removeSubject(element) {
        element.parentNode.remove();
    }

    document.getElementById("classForm").addEventListener("submit", async function(event) {
        event.preventDefault();

        // Show confirmation popup
        let confirmUpload = confirm("Are you sure you want to upload this class?");
        if (!confirmUpload) return;

        let formData = new FormData(this);
        let data = {
            classID: formData.get("classID"),
            branch: formData.get("branch"),
            semester: formData.get("semester"),
            subjects: formData.getAll("subjects[]").filter(s => s.trim() !== ""),
            timeTable: []  // Now an array of objects
        };

        const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
        days.forEach(day => {
            let hours = {};
            let hourInputs = document.querySelectorAll(`input[name="${day.toLowerCase()}[]"]`);
            
            hourInputs.forEach((input, index) => {
                if (input.value.trim() !== "") {
                    hours[index + 1] = input.value.trim();
                }
            });

            if (Object.keys(hours).length > 0) {
                data.timeTable.push({ day, hours }); 
            }
        });

        let response = await fetch("/add-class", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
        });

        let result = await response.json();
        alert(result.message);
        if (result.success) this.reset();
    });
</script>

</body>
</html>
